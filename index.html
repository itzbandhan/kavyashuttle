<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kavya Shuttle</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="shortcut icon" href="https://kavyaschool.edu.np/favicon.ico">
</head>

<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen">

<!-- HEADER -->
<header class="sticky top-0 backdrop-blur-sm z-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
    <div class="flex items-center justify-center sm:justify-start">
      <div class="flex items-center gap-3">
        <img
          src="https://kavyaschool.edu.np/images/Kavya-Ing.svg"
          class="h-10 sm:h-12 md:h-14 w-auto object-contain"
          alt="Kavya Logo"
        />
      </div>
    </div>
  </div>
</header>

<!-- HERO SECTION -->
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2 sm:py-4 lg:py-6">
  <div class="bg-white rounded-3xl sm:rounded-[32px] lg:rounded-[40px] shadow-2xl overflow-hidden">
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-0">

      <!-- TEXT CONTENT -->
      <div class="px-6 pt-4 pb-6 sm:px-8 sm:pt-6 sm:pb-5 lg:px-12 lg:pt-8 lg:pb-6 flex flex-col justify-center">
        <div class="space-y-5 sm:space-y-8">
          
          <div class="space-y-3 sm:space-y-4 mb-6 sm:mb-8">
            <h1 class="text-3xl sm:text-4xl lg:text-5xl xl:text-6xl font-bold leading-tight text-slate-900">
              Find the <span class="text-[#76c044]">best shuttle</span><br class="hidden sm:inline">
              from your nearest stop
            </h1>

            <p class="text-base sm:text-lg text-slate-600 leading-relaxed">
              A smart shuttle route finder designed exclusively for Kavya School +2 students.
            </p>
          </div>

          <!-- SEARCH BOX -->
          <div class="space-y-4">

            <div class="relative">
              <input
                id="searchInput"
                type="text"
                placeholder="Type your location (e.g. Gatthaghar)"
                class="hidden w-full px-4 py-3.5 sm:py-4 rounded-xl sm:rounded-2xl border-2 border-slate-200 focus:border-[#76c044] focus:ring-4 focus:ring-[#76c044]/10 outline-none transition text-base sm:text-lg"
              />
              
              <div
                id="suggestions"
                class="hidden absolute top-full left-0 right-0 mt-2 bg-white border-2 border-slate-200 rounded-2xl shadow-2xl overflow-hidden z-10 max-h-64 overflow-y-auto"
              ></div>
            </div>

            <!-- ACTION BUTTONS -->
            <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
              <button
                id="findBtn"
                class="w-full sm:flex-1 bg-[#76c044] hover:bg-[#68a93c] active:bg-[#5d9635] text-white px-6 py-3.5 sm:py-4 rounded-xl sm:rounded-2xl font-semibold text-base sm:text-lg transition-all duration-200 shadow-lg shadow-[#76c044]/20 hover:shadow-xl hover:shadow-[#76c044]/30 hover:-translate-y-0.5">
                Find My Route
              </button>

              <button
                id="locationBtn"
                class="w-full sm:flex-1 bg-white border-2 border-[#76c044] text-[#76c044] hover:bg-[#76c044] hover:text-white px-6 py-3.5 sm:py-4 rounded-xl sm:rounded-2xl font-semibold text-base sm:text-lg transition-all duration-200 hover:shadow-lg hover:-translate-y-0.5">
                üìç Use GPS Location
              </button>
            </div>

            <p id="error" class="text-sm sm:text-base text-red-600 font-medium hidden"></p>
          </div>

        </div>
      </div>

      <!-- IMAGE -->
      <div class="w-full bg-gradient-to-br from-slate-50 to-slate-100 p-[10px] flex items-center justify-center">
        <img
          src="/kavyashuttle.png"
          class="rounded-2xl sm:rounded-3xl w-full max-w-xs sm:max-w-sm lg:max-w-md object-contain drop-shadow-2xl"
          alt="Shuttle Van"
        />
      </div>

    </div>
  </div>
</main>

<!-- FEATURE CARDS -->
<section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-10 lg:py-16">
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8">

    <div class="bg-white rounded-2xl sm:rounded-3xl p-6 sm:p-8 shadow-xl hover:shadow-2xl transition-all duration-300 border border-slate-100 hover:border-slate-200">
      <div class="text-4xl sm:text-5xl mb-4">üîç</div>
      <h3 class="font-bold text-lg sm:text-xl mb-2 text-slate-900">Search by location</h3>
      <p class="text-sm sm:text-base text-slate-600 leading-relaxed">
        Type a few letters and get instant suggestions for nearby routes.
      </p>
    </div>

    <div class="bg-white rounded-2xl sm:rounded-3xl p-6 sm:p-8 shadow-xl hover:shadow-2xl transition-all duration-300 border border-slate-100 hover:border-slate-200">
      <div class="text-4xl sm:text-5xl mb-4">üìç</div>
      <h3 class="font-bold text-lg sm:text-xl mb-2 text-slate-900">Use GPS</h3>
      <p class="text-sm sm:text-base text-slate-600 leading-relaxed">
        Automatically detects your nearest pickup point using your location.
      </p>
    </div>

    <div class="bg-white rounded-2xl sm:rounded-3xl p-6 sm:p-8 shadow-xl hover:shadow-2xl transition-all duration-300 border border-slate-100 hover:border-slate-200 sm:col-span-2 lg:col-span-1">
      <div class="text-4xl sm:text-5xl mb-4">‚úÖ</div>
      <h3 class="font-bold text-lg sm:text-xl mb-2 text-slate-900">Verified routes</h3>
      <p class="text-sm sm:text-base text-slate-600 leading-relaxed">
        Official school shuttles with verified routes and driver details.
      </p>
    </div>

  </div>
</section>

<!-- FOOTER -->
<footer class="bg-white border-t border-slate-200 mt-8 sm:mt-12">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 text-center">
    <p class="text-sm sm:text-base text-slate-600 font-medium">
      Made with üíö by Students at Kavya School
    </p>
  </div>
</footer>

<script>
let routesData = {};
const searchInput = document.getElementById("searchInput");
const suggestionsBox = document.getElementById("suggestions");
const errorBox = document.getElementById("error");
const findBtn = document.getElementById("findBtn");
const locationBtn = document.getElementById("locationBtn");

fetch("index.json")
  .then(res => res.json())
  .then(data => {
    routesData = data;
  })
  .catch(() => {
    showError("Failed to load route data.");
  });

function getScore(query, text) {
  if (text === query) return 6;
  if (text.startsWith(query)) return 4;
  if (text.includes(query)) return 2;
  return 0;
}

searchInput.addEventListener("input", () => {
  const query = searchInput.value.trim().toLowerCase();
  suggestionsBox.innerHTML = "";
  errorBox.classList.add("hidden");

  if (!query) {
    suggestionsBox.classList.add("hidden");
    return;
  }

  let results = [];

  Object.entries(routesData).forEach(([routeId, route]) => {
    route.pickup_locations.forEach(loc => {
      const name = loc.name.toLowerCase();
      const score = getScore(query, name);

      if (score > 0) {
        results.push({
          routeId,
          routeName: route.route_name,
          location: loc.name,
          score: score + query.length / name.length
        });
      }
    });
  });

  if (!results.length) {
    suggestionsBox.classList.add("hidden");
    return;
  }

  results.sort((a, b) => b.score - a.score);

  const unique = [];
  const seen = new Set();

  for (let r of results) {
    if (!seen.has(r.routeId)) {
      unique.push(r);
      seen.add(r.routeId);
    }
    if (unique.length === 4) break;
  }

  unique.forEach(r => {
    const div = document.createElement("div");
    div.className = "px-4 sm:px-5 py-3.5 sm:py-4 cursor-pointer hover:bg-[#76c044]/5 active:bg-[#76c044]/10 transition-colors border-b last:border-b-0";

    div.innerHTML = `
      <div class="font-semibold text-base sm:text-lg text-slate-900">${r.location}</div>
      <div class="text-xs sm:text-sm text-slate-500 mt-1">
        Route-${r.routeId} ‚Ä¢ ${r.routeName}
      </div>
    `;

    div.onclick = () => {
      window.location.href = `route.html?id=${r.routeId}`;
    };

    suggestionsBox.appendChild(div);
  });

  suggestionsBox.classList.remove("hidden");
});

findBtn.onclick = () => {
  const input = searchInput;
  
  if (input.classList.contains("hidden")) {
    input.classList.remove("hidden");
    input.focus();
  } else {
    const query = searchInput.value.trim().toLowerCase();

    if (!query) {
      showError("Please type your nearest location.");
      return;
    }

    let bestMatch = null;
    let bestScore = 0;

    Object.entries(routesData).forEach(([routeId, route]) => {
      route.pickup_locations.forEach(loc => {
        const name = loc.name.toLowerCase();
        const score = getScore(query, name);
        if (score > bestScore) {
          bestScore = score;
          bestMatch = routeId;
        }
      });
    });

    if (!bestMatch) {
      showError("No matching route found.");
      return;
    }

    window.location.href = `route.html?id=${bestMatch}`;
  }
};

locationBtn.onclick = () => {
  errorBox.classList.add("hidden");

  if (!navigator.geolocation) {
    showError("Geolocation not supported.");
    return;
  }

  navigator.geolocation.getCurrentPosition(pos => {
    const { latitude, longitude } = pos.coords;
    let closest = { dist: Infinity, routeId: null };

    Object.entries(routesData).forEach(([routeId, route]) => {
      route.pickup_locations.forEach(loc => {
        const d = haversine(
          latitude,
          longitude,
          parseFloat(loc.latitude),
          parseFloat(loc.longitude)
        );

        if (d < closest.dist) {
          closest = { dist: d, routeId };
        }
      });
    });

    if (closest.dist > 5 || !closest.routeId) {
      showError(
        "No route found nearby. Please contact student services."
      );
      return;
    }

    window.location.href = `route.html?id=${closest.routeId}`;
  });
};

function showError(msg) {
  errorBox.innerText = msg;
  errorBox.classList.remove("hidden");
}

function haversine(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;

  const a =
    Math.sin(dLat / 2) ** 2 +
    Math.cos(lat1 * Math.PI / 180) *
    Math.cos(lat2 * Math.PI / 180) *
    Math.sin(dLon / 2) ** 2;

  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}
</script>

</body>
</html>